{% extends "base.html" %}

{% block title %}Dashboard | AI Interviewer{% endblock %}

{% block content %}
<section class="dashboard-section">
    <div class="container">
        <div class="dashboard-header fade-up">
            <h1>Welcome Back</h1>
            <p>Ready to practice? Configure your session below.</p>
        </div>

        <div class="dashboard-grid">
            <!-- Configuration Panel -->
            <div class="glass-panel config-panel fade-up">
                <h2>New Session</h2>

                <div class="input-group">
                    <label class="input-label">Interview Mode</label>
                    <div class="select-wrapper">
                        <select id="mode" class="glass-input">
                            <option value="HR">HR Interview (Behavioral & Culture)</option>
                            <option value="Technical">Technical Interview (Deep Dive)</option>
                            <option value="Managerial">Managerial Interview (Leadership)</option>
                            <option value="Behavioral">Behavioral (STAR Method)</option>
                        </select>
                        <div class="arrow">‚ñº</div>
                    </div>
                </div>

                <div class="input-group">
                    <label class="input-label">Job Role (Optional)</label>
                    <div class="select-wrapper">
                        <select id="jobRole" class="glass-input">
                            <option value="">General Interview</option>
                            <option value="ML Engineer">ü§ñ ML Engineer</option>
                            <option value="Python Developer">üêç Python Developer</option>
                            <option value="Data Analyst">üìä Data Analyst</option>
                            <option value="Robotics Engineer">ü¶æ Robotics Engineer</option>
                            <option value="Cloud Engineer">‚òÅÔ∏è Cloud Engineer</option>
                            <option value="QA Engineer">‚úÖ QA Engineer</option>
                        </select>
                    </div>
                </div>

                <div class="input-group">
                    <label class="input-label">Company Simulation (Optional)</label>
                    <div class="custom-company-wrapper">
                        <div class="custom-company-trigger" id="companyTrigger">
                            <span id="selectedCompanyText">Standard Interview</span>
                            <div class="arrow">‚ñº</div>
                        </div>
                        <div class="custom-company-dropdown" id="companyDropdown">
                            <div class="company-option" data-value="">
                                <span class="company-name">Standard Interview</span>
                            </div>
                            <div class="company-option" data-value="Google">
                                <img src="https://www.google.com/s2/favicons?domain=google.com&sz=128" alt="Google"
                                    class="company-logo">
                                <span class="company-name">Google</span>
                            </div>
                            <div class="company-option" data-value="Amazon">
                                <img src="https://www.google.com/s2/favicons?domain=amazon.com&sz=128" alt="Amazon"
                                    class="company-logo">
                                <span class="company-name">Amazon</span>
                            </div>
                            <div class="company-option" data-value="Microsoft">
                                <img src="https://www.google.com/s2/favicons?domain=microsoft.com&sz=128"
                                    alt="Microsoft" class="company-logo">
                                <span class="company-name">Microsoft</span>
                            </div>
                            <div class="company-option" data-value="Apple">
                                <img src="https://www.google.com/s2/favicons?domain=apple.com&sz=128" alt="Apple"
                                    class="company-logo">
                                <span class="company-name">Apple</span>
                            </div>
                            <div class="company-option" data-value="Meta">
                                <img src="https://www.google.com/s2/favicons?domain=meta.com&sz=128" alt="Meta"
                                    class="company-logo">
                                <span class="company-name">Meta</span>
                            </div>
                            <div class="company-option" data-value="Netflix">
                                <img src="https://www.google.com/s2/favicons?domain=netflix.com&sz=128" alt="Netflix"
                                    class="company-logo">
                                <span class="company-name">Netflix</span>
                            </div>
                            <div class="company-option" data-value="Tesla">
                                <img src="https://www.google.com/s2/favicons?domain=tesla.com&sz=128" alt="Tesla"
                                    class="company-logo">
                                <span class="company-name">Tesla</span>
                            </div>
                            <div class="company-option" data-value="Nvidia">
                                <img src="https://www.google.com/s2/favicons?domain=nvidia.com&sz=128" alt="Nvidia"
                                    class="company-logo">
                                <span class="company-name">Nvidia</span>
                            </div>
                            <div class="company-option" data-value="Oracle">
                                <img src="https://www.google.com/s2/favicons?domain=oracle.com&sz=128" alt="Oracle"
                                    class="company-logo">
                                <span class="company-name">Oracle</span>
                            </div>
                            <div class="company-option" data-value="Cisco">
                                <img src="https://www.google.com/s2/favicons?domain=cisco.com&sz=128" alt="Cisco"
                                    class="company-logo">
                                <span class="company-name">Cisco</span>
                            </div>
                            <div class="company-option" data-value="Qualcomm">
                                <img src="https://www.google.com/s2/favicons?domain=qualcomm.com&sz=128" alt="Qualcomm"
                                    class="company-logo">
                                <span class="company-name">Qualcomm</span>
                            </div>
                            <div class="company-option" data-value="VMWare">
                                <img src="https://www.google.com/s2/favicons?domain=vmware.com&sz=128" alt="VMWare"
                                    class="company-logo">
                                <span class="company-name">VMWare</span>
                            </div>
                            <div class="company-option" data-value="TCS">
                                <img src="https://www.google.com/s2/favicons?domain=tcs.com&sz=128" alt="TCS"
                                    class="company-logo">
                                <span class="company-name">TCS</span>
                            </div>
                            <div class="company-option" data-value="Infosys">
                                <img src="https://www.google.com/s2/favicons?domain=infosys.com&sz=128" alt="Infosys"
                                    class="company-logo">
                                <span class="company-name">Infosys</span>
                            </div>
                            <div class="company-option" data-value="Accenture">
                                <img src="https://www.google.com/s2/favicons?domain=accenture.com&sz=128"
                                    alt="Accenture" class="company-logo">
                                <span class="company-name">Accenture</span>
                            </div>
                            <div class="company-option" data-value="Wipro">
                                <img src="https://www.google.com/s2/favicons?domain=wipro.com&sz=128" alt="Wipro"
                                    class="company-logo">
                                <span class="company-name">Wipro</span>
                            </div>
                            <div class="company-option" data-value="Cognizant">
                                <img src="https://www.google.com/s2/favicons?domain=cognizant.com&sz=128"
                                    alt="Cognizant" class="company-logo">
                                <span class="company-name">Cognizant</span>
                            </div>
                            <div class="company-option" data-value="Deloitte">
                                <img src="https://www.google.com/s2/favicons?domain=deloitte.com&sz=128" alt="Deloitte"
                                    class="company-logo">
                                <span class="company-name">Deloitte</span>
                            </div>
                            <div class="company-option" data-value="EY">
                                <img src="https://www.google.com/s2/favicons?domain=ey.com&sz=128" alt="EY"
                                    class="company-logo">
                                <span class="company-name">EY (Ernst & Young)</span>
                            </div>
                            <div class="company-option" data-value="PWC">
                                <img src="https://www.google.com/s2/favicons?domain=pwc.com&sz=128" alt="PWC"
                                    class="company-logo">
                                <span class="company-name">PwC</span>
                            </div>
                            <div class="company-option" data-value="KPMG">
                                <img src="https://www.google.com/s2/favicons?domain=kpmg.com&sz=128" alt="KPMG"
                                    class="company-logo">
                                <span class="company-name">KPMG</span>
                            </div>
                            <div class="company-option" data-value="HCL">
                                <img src="https://www.google.com/s2/favicons?domain=hcltech.com&sz=128" alt="HCL"
                                    class="company-logo">
                                <span class="company-name">HCLTech</span>
                            </div>
                            <div class="company-option" data-value="TechMahindra">
                                <img src="https://www.google.com/s2/favicons?domain=techmahindra.com&sz=128"
                                    alt="Tech Mahindra" class="company-logo">
                                <span class="company-name">Tech Mahindra</span>
                            </div>
                            <div class="company-option" data-value="LTIMindtree">
                                <img src="https://www.google.com/s2/favicons?domain=ltimindtree.com&sz=128"
                                    alt="LTIMindtree" class="company-logo">
                                <span class="company-name">LTIMindtree</span>
                            </div>
                            <div class="company-option" data-value="Hexaware">
                                <img src="https://www.google.com/s2/favicons?domain=hexaware.com&sz=128" alt="Hexaware"
                                    class="company-logo">
                                <span class="company-name">Hexaware</span>
                            </div>
                            <div class="company-option" data-value="Mphasis">
                                <img src="https://www.google.com/s2/favicons?domain=mphasis.com&sz=128" alt="Mphasis"
                                    class="company-logo">
                                <span class="company-name">Mphasis</span>
                            </div>
                            <div class="company-option" data-value="Persistent">
                                <img src="https://www.google.com/s2/favicons?domain=persistent.com&sz=128"
                                    alt="Persistent" class="company-logo">
                                <span class="company-name">Persistent</span>
                            </div>
                            <div class="company-option" data-value="Zensar">
                                <img src="https://www.google.com/s2/favicons?domain=zensar.com&sz=128" alt="Zensar"
                                    class="company-logo">
                                <span class="company-name">Zensar</span>
                            </div>
                            <div class="company-option" data-value="KPIT">
                                <img src="https://www.google.com/s2/favicons?domain=kpit.com&sz=128" alt="KPIT"
                                    class="company-logo">
                                <span class="company-name">KPIT</span>
                            </div>
                            <div class="company-option" data-value="Cybage">
                                <img src="https://www.google.com/s2/favicons?domain=cybage.com&sz=128" alt="Cybage"
                                    class="company-logo">
                                <span class="company-name">Cybage</span>
                            </div>
                            <div class="company-option" data-value="Volkswagen">
                                <img src="https://www.google.com/s2/favicons?domain=volkswagen.com&sz=128"
                                    alt="Volkswagen" class="company-logo">
                                <span class="company-name">Volkswagen</span>
                            </div>
                        </div>
                        <input type="hidden" id="company" value="">
                    </div>
                </div>

                <div class="input-group">
                    <label class="input-label">Resume Context (Optional)</label>
                    <div class="file-upload-wrapper">
                        <input type="file" id="resume" accept=".pdf,.txt" class="file-input" hidden>
                        <label for="resume" class="file-label">
                            <span class="icon">üìÑ</span>
                            <span class="text">Click to upload PDF or TXT</span>
                        </label>
                    </div>
                    <div id="file-name" class="file-name"></div>
                </div>

                <button class="btn btn-primary btn-lg full-width" onclick="startInterview()">
                    Start Simulation <div class="btn-glow"></div>
                </button>
            </div>

            <!-- Recent Activity / Stats -->
            <div class="stats-panel-wrapper fade-up">
                <div class="glass-panel stats-panel">
                    <h3>Your Progress</h3>
                    <div class="mini-stat">
                        <span class="label">Interviews Completed</span>
                        <span class="value">0</span>
                    </div>
                    <div class="mini-stat">
                        <span class="label">Avg. Score</span>
                        <span class="value">-</span>
                    </div>

                    <div class="recent-activity">
                        <h4>Recent Sessions</h4>
                        <p class="empty-state">No recent interviews found.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<style>
    /* Custom Company Dropdown Styles */
    .custom-company-wrapper {
        position: relative;
        width: 100%;
    }

    .custom-company-trigger {
        width: 100%;
        background: rgba(255, 255, 255, 0.9);
        border: 2px solid var(--border-subtle);
        padding: 16px;
        border-radius: var(--radius-sm);
        color: var(--text-main);
        font-family: 'Inter', sans-serif;
        font-size: 1rem;
        cursor: pointer;
        transition: var(--transition-fast);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .custom-company-trigger:hover {
        border-color: var(--primary);
        background: white;
    }

    .custom-company-trigger .arrow {
        position: relative;
        color: var(--text-muted);
        font-size: 0.8rem;
        transition: transform 0.3s ease;
    }

    .custom-company-wrapper.open .custom-company-trigger .arrow {
        transform: rotate(180deg);
    }

    .custom-company-dropdown {
        position: absolute;
        top: calc(100% + 8px);
        left: 0;
        right: 0;
        background: rgba(255, 255, 255, 0.98);
        border: 2px solid var(--border-subtle);
        border-radius: var(--radius-sm);
        box-shadow: 0 10px 40px rgba(44, 62, 80, 0.15);
        max-height: 350px;
        overflow-y: auto;
        z-index: 9999;
        opacity: 0;
        visibility: hidden;
        transform: translateY(-10px);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .custom-company-wrapper.open .custom-company-dropdown {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
    }

    .company-option {
        display: flex;
        align-items: center;
        padding: 12px 16px;
        cursor: pointer;
        transition: all 0.2s ease;
        border-bottom: 1px solid rgba(44, 62, 80, 0.08);
    }

    .company-option:last-child {
        border-bottom: none;
    }

    .company-option:hover {
        background: var(--primary-light);
        padding-left: 20px;
    }

    .company-option.selected {
        background: var(--primary-light);
        border-left: 3px solid var(--primary);
    }

    .company-logo {
        width: 32px;
        height: 32px;
        object-fit: contain;
        border-radius: 6px;
        background: #fff;
        padding: 4px;
        margin-right: 12px;
        border: 1px solid rgba(44, 62, 80, 0.1);
    }

    .company-name {
        color: var(--text-main);
        font-size: 0.95rem;
        font-weight: 500;
    }

    /* Scrollbar Styling */
    .custom-company-dropdown::-webkit-scrollbar {
        width: 8px;
    }

    .custom-company-dropdown::-webkit-scrollbar-track {
        background: rgba(44, 62, 80, 0.05);
        border-radius: 4px;
    }

    .custom-company-dropdown::-webkit-scrollbar-thumb {
        background: rgba(44, 62, 80, 0.2);
        border-radius: 4px;
    }

    .custom-company-dropdown::-webkit-scrollbar-thumb:hover {
        background: rgba(44, 62, 80, 0.3);
    }
</style>


<script>
    function startInterview() {
        const mode = document.getElementById('mode').value;
        const jobRole = document.getElementById('jobRole').value;
        const company = document.getElementById('company').value;
        const resumeFile = document.getElementById('resume').files[0];

        // Validate inputs
        if (!mode) {
            alert('Please select an interview mode');
            return;
        }

        // Create FormData
        const formData = new FormData();
        formData.append('mode', mode);
        if (jobRole) formData.append('job_role', jobRole);
        if (company) formData.append('company', company);
        if (resumeFile) formData.append('resume', resumeFile);

        // Show loading state
        const btn = document.querySelector('button');
        const originalText = btn.innerHTML;
        btn.innerHTML = 'Initializing... <div class="spinner"></div>';
        btn.disabled = true;

        // Send request
        fetch('/start_interview', {
            method: 'POST',
            body: formData
        })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    window.location.href = '/interview';
                } else {
                    alert('Error: ' + data.message);
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred while starting the interview');
                btn.innerHTML = originalText;
                btn.disabled = false;
            });
    }


    // File Upload Handling
    document.getElementById('resume').addEventListener('change', function (e) {
        const fileName = e.target.files[0]?.name;
        const fileDisplay = document.getElementById('file-name');
        if (fileName) {
            fileDisplay.textContent = `Selected: ${fileName}`;
            fileDisplay.classList.add('active');
        } else {
            fileDisplay.textContent = '';
            fileDisplay.classList.remove('active');
        }
    });

    // Custom Company Dropdown Logic
    document.addEventListener('DOMContentLoaded', function () {
        const wrapper = document.querySelector('.custom-company-wrapper');
        const trigger = document.getElementById('companyTrigger');
        const dropdown = document.getElementById('companyDropdown');
        const companyOptions = document.querySelectorAll('.company-option');
        const selectedText = document.getElementById('selectedCompanyText');
        const hiddenInput = document.getElementById('company');

        // Toggle dropdown
        trigger.addEventListener('click', function (e) {
            e.stopPropagation();
            wrapper.classList.toggle('open');
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', function (e) {
            if (!wrapper.contains(e.target)) {
                wrapper.classList.remove('open');
            }
        });

        // Handle option selection
        companyOptions.forEach(option => {
            option.addEventListener('click', function () {
                const value = this.getAttribute('data-value');
                const name = this.querySelector('.company-name').textContent;

                // Update selected text
                selectedText.textContent = name;
                hiddenInput.value = value;

                // Update selected styling
                companyOptions.forEach(opt => opt.classList.remove('selected'));
                this.classList.add('selected');

                // Close dropdown
                wrapper.classList.remove('open');
            });
        });
    });

</script>
{% endblock %}